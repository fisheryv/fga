% !TeX root = ../../fga.tex
\section{Relative Cartier divisors and projective bundles}\label{fga3.v-4}


We will only need to use positive divisors, and we omit the qualification of "positive" in the rest of this section.

Let $X$ be a prescheme.
A \emph{Cartier divisor}, or simply divisor, on $X$ is a closed subprescheme $D$ of $X$ defined by an ideal $\mathcal{J}$ that is an \emph{invertible} module, i.e. locally generated by a section that is a \emph{non-zero divisor} of $\mathcal{O}_X$.
To $D$ we associate the invertible module
\[
    \mathcal{L}(D) = \mathcal{J}^{-1}
\]
and the canonical injection $\mathcal{J}\to\mathcal{O}_X$ gives a canonical homomorphism
\[
    s_D\colon \mathcal{O}_X \to \mathcal{J}^{-1} = \mathcal{L}(D)
\]
i.e. $s_D\in\operatorname{G_a}mma(X,\mathcal{L}(D))$.
The data of a divisor is essentially \emph{equivalent} to the data of an invertible module $\mathcal{L}$ on $X$ endowed with a section $s$ that is nowhere a zero divisor, by associating to such a pair $(\mathcal{L},s)$ the "divisor" of $s$, denoted by $\div(s)$.
For a given invertible $\mathcal{L}$ on $X$, the set of divisors $D$ that define $\mathcal{L}$ is in bijective correspondence with the quotient set $\operatorname{G_a}mma(X,\mathcal{L})^{\times}/\operatorname{G_a}mma(X,\mathcal{O}_X^\times)$, where $\operatorname{G_a}mma(X,\mathcal{L})^\times$ denotes the subset of $\operatorname{G_a}mma(X,\mathcal{L})$ consisting of sections that are nowhere zero divisors.

Now suppose that we have a morphism $f\colon X\to S$ that is locally of finite type, and suppose, for simplicity, that $S$ is locally Noetherian.
Let $\mathcal{J}$ be a coherent ideal on $X$, with $D$ the subscheme of $X$ that it defines, and let $x\in X$ and $s=f(x)$.
We will show that the following conditions are equivalent:
\begin{enumerate}[i.]
    \item $\mathcal{J}$ is invertible at $x$ (i.e. $\mathcal{J}_x$ is generated by a regular element of $\mathcal{O}_{X,x}$) and $D$ is flat over $S$ at $x$.
    \item  $X$ and $D$ are flat over $S$ at $x$, and $D_s$ is a Cartier divisor on the fibre $X_s$ at the point $x$.
    \item $X$ is flat over $S$ at $x$, and $\mathcal{J}_x$ is generated by an element $f_x$ that induces on $X_s$ a non-zero divisor germ.
\end{enumerate}

We then say that $D$ is a \emph{relative Cartier divisor} or simply a relative divisor, on $X/S$ at the point in question.
We note that, in (i), $D$ is also a relative divisor at points in a neighbourhood of $x$, so if $X$ and $D$ are flat over $S$, with $D$ proper over $S$, then the set of $s\in S$ such that $D_s$ is a Cartier divisor in $X_s$ (i.e. such that $D$ is a relative Cartier divisor at the points of $X_s$) is an open subset of $S$.
We have also done what is necessary in the definition above in order to ensure that the notion of relative Cartier divisor be stable under arbitrary base change $S'\to S$.
So consider the set $\operatorname{Div}(X/S)$ of relative divisors on $X/S$, and then the contravariant functor in $S'$ (that varies over $S$) defined by
\[
    \mathcal{D}iv_{X/S}(S') = \operatorname{Div}(X\times_S S'/S').
\]
Suppose that $X$ is flat and proper over $S$.
Then by the characterisation (ii) of relative Cartier divisors, $\mathcal{D}iv_{X/S}$ can be considered as a sub-functor of the functor $\mathcal{H}ilb_{X/S}$ defined in \Cref{fga3.iv}, and the inclusion morphism
\[
    \mathcal{D}iv_{X/S} \to \mathcal{H}ilb_{X/S}
\]
is "representable by open immersions" (cf. \cite{Gro1960a}, IV, 3.13) by the above remarks.
Using the principal existence theorem of \Cref{fga3.iv}, we find:

\begin{proposition}\label{fga3.v-4-proposition-4.1}
    Suppose that $f\colon X\to S$ is projective and flat.
    Then the functor $\mathcal{D}iv_{X/S}$ is representable, and, more precisely, is represented by an open of $\underline{\operatorname{Hilb}}_{X/S}$.
\end{proposition}


For a given very ample sheaf $\mathcal{O}_X(1)$ over $X/S$, using the canonical decomposition of $\underline{\operatorname{Hilb}}_{X/S}$ into a sum of opens $\underline{\operatorname{Hilb}}_{X/S}^Q$ corresponding to Hilbert polynomials $Q\in\mathbb{Q}[t]$, we obtain an analogous decomposition
\[
    \underline{\operatorname{Div}}_{X/S}
    = \sqcup_{Q\in\mathbb{Q}[t]} \underline{\operatorname{Div}}_{X/S}^Q
\]
into a sum of disjoint opens that are \emph{quasi-projective} over $S$.

Using the map $D\mapsto\mathcal{L}(D)$, we obtain a functorial homomorphism
\[
    \mathcal{D}iv_{X/S} \to \mathcal{P}ic_{X/S} \tag{+}
\]
that we propose to study;
it appears to be relatively representable (\cite{Gro1960a}, IV, 3) under rather general conditions.
We thus start with an element $\xi$ of $\mathcal{P}ic_{X/S}(S')$, supposing, to simplify notation, that $S'=S$;
we will show that the corresponding sub-functor of $\mathcal{D}iv_{X/S}$ is representable.
Consider first of all the case where $\xi$ is defined by an invertible module $\mathcal{L}$ on $X$.
Suppose that $X$ is proper and flat over $S$, and that the geometric fibres of $X$ over $S$ are integral, which also implies (\cite{GD1960}, III, §7] that $\mathcal{O}_S\xrightarrow{\sim} f_*(\mathcal{O}_X)$, and that this remains true after any base change $S'\to S$.
Then the relative Cartier divisors $D$ on $X/S$ such that $\mathcal{L}(D)$ and $\mathcal{L}$ define the same element of $\operatorname{Pic}(X/S)=\mathcal{P}ic_{X/S}(S)$, i.e. by \Cref{fga3.v-2-corollary-2.4} such that $\mathcal{L}(D)$ and $\mathcal{L}$ are locally isomorphic over $S$, are in bijective correspondence with the sections of the quotient sheaf $f_*(\mathcal{L})^{\times}/\mathcal{O}_S^\times$.
This correspondence is compatible with base change.
General arguments of "Künneth" type from \emph{loc. cit.} and [Mumford–Tate seminar, 1962] show that the property of $X/S$ and the flatness of $\mathcal{L}$ over $S$ imply the existence of a coherent module $\mathcal{Q}$ on $S$, defined up to unique isomorphism, and an isomorphism of sheaves
\[
    f_*(\mathcal{L}) \xrightarrow{\sim} \mathcal{H}om_{\mathcal{O}_X}(\mathcal{Q},\mathcal{O}_S)
\]
and the formation of $\mathcal{Q}$ is furthermore compatible with base change.
Here $f_*(\mathcal{L})^\times$ denotes the subsheaf of sets of $f_*(\mathcal{L})$ whose sections over $U$ are the sections of $\mathcal{L}$ over $f^{-1}(U)$ that define relative Cartier divisors on $f^{-1}(U)/U$, i.e. that induces sections that are non-zero divisors on the $X_s$ (for $s\in U$).
Using the hypothesis that the fibres $X_s$ are integral, this simply implies that the induced sections on the fibres $X_s$ are not identically zero, or, in terms of local homomorphisms $\mathcal{Q}\to\mathcal{O}_S$, that these homomorphisms are surjective (Nakayama).
This shows that the set of sections of $f_*(\mathcal{L})^{\times}/\mathcal{O}_S^\times$ is in bijective correspondence with the set of \emph{invertible quotient modules of $\mathcal{Q}$}, or, by the definition of the projective bundle $\mathbb{P}(\mathcal{Q})$ associated to the coherent module $\mathcal{Q}$ (cf. \cite{Gro1960a}, V, §2), with the set of sections of $\mathbb{P}(\mathcal{Q})$ over $S$.
This description is compatible with taking inverse images, and we thus obtain the theorem below.

\begin{theorem}\label{fga3.v-4-theorem-4.3}
    Let $f\colon X\to S$ be a flat proper morphism with integral geometric fibres, with $S$ locally Noetherian, and let $\mathcal{L}$ be an invertible module on $X$.
    For every $S'$ over $S$, let $T(S')$ be the set of relative divisors $D$ on $X\times_S S'/S'$ such that $\mathcal{L}(D)$ is locally isomorphic to $\mathcal{L}\otimes_{\mathcal{O}_S}\mathcal{O}_{S'}$ over $S'$ (i.e. such that $\mathcal{L}(D)$ and $\mathcal{L}\otimes_{\mathcal{O}_S}\mathcal{O}_{S'}$) define the same element of $\operatorname{Pic}(X\times_S S'/S')$.
    Then there exists a coherent module $\mathcal{Q}$ on $S$, determined up to unique isomorphism, such that the functor $T$ is represented by the projective bundle $\mathbb{P}(\mathcal{Q})$.
\end{theorem}


\begin{corollary}\label{fga3.v-4-corollary-4.4}
    If we suppose that $f$ is projective, then the functorial homomorphism $\mathcal{D}iv_{X/S}\to\mathcal{P}ic_{X/S}$ is representable by projective morphisms.
\end{corollary}


If $X$ admits a section (resp. locally admits a section) over $S$, then the above homomorphism is representable by projective bundles (resp. by local projective bundles) thanks to \Cref{fga3.v-4-theorem-4.3} and \Cref{fga3.v-2-proposition-2.1}.
In the case where $f$ is quasi-projective, we can easily reduce to the previous case by a descent method, using the finite flat local quasi-sections of $X$ over $S$.



\begin{remark}\label{fga3.v-4-remark-4.5}
    Under the conditions of \Cref{fga3.v-4-theorem-4.3}, the module $\mathcal{Q}$ on $S$ is not in general locally free, as we can see by the fact that the dimension of the reduced fibres of $\mathcal{Q}$, i.e. those of $\operatorname{H}^0(X_s,\mathcal{L}_s)$ for varying $s\in S$, can \emph{jump}.
    Given a coherent module $\mathcal{Q}$ on the locally Noetherian prescheme $S$, we can easily show that, for any given $s\in S$, $\mathcal{Q}$ is free at $s$ if and only if $\mathbb{P}(\mathcal{Q})$ is flat over $S$ at the points over $s$ (in which case it is even simple over $S$ at the points over $s$);
    when this happens, with $\mathcal{Q}$ defined in terms of $\mathcal{L}$ as above, this also implies that forming the direct image $f_*(\mathcal{L})$ \emph{"commutes with base change on a neighbourhood of $s$"}, or that $f_*(\mathcal{L})_s\to\operatorname{H}^0(X_s,\mathcal{L}_s)$ is surjective.
    This will be the case if, for example, $\operatorname{H}^1(X_s,\mathcal{L}_s)=0$.
    Subject to the existence of the preschemes in question, these criteria apply in particular to the universal situation $\underline{\operatorname{Div}}_{X/S}\to\underline{\operatorname{Pic}}_{X/S}$, and give a necessary and sufficient condition (resp. sufficient) for this morphism to be simple at a given point of $\underline{\operatorname{Div}}_{X/S}$.
\end{remark}